<?php
session_start();
if (!isset($_SESSION['usuario'])||($_SESSION['usuario']!="Administrador"))
{
  header("location:Login.html");
}
?>
<!doctype html>
<html>
        <head >
	
                <!--<link rel="icon" type="image/png" href="assets/img/favicon.ico">-->
                <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
                <meta http-equiv="Content-type" Content-type="application/docx" content="text/html; charset=utf-8" />
                <title>SISTEMA INTEGRADO DE GESTIÓN</title>
            
                <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
                <meta name="viewport" content="width=device-width" />
            
                <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
            
                <link rel="stylesheet" href="css/Gestor.css">
                <!-- Bootstrap core CSS     -->
                <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" />
            
                <!--  Light Bootstrap Table core CSS    -->
                <link href="bootstrap/css/light-bootstrap-dashboard.css?v=1.4.0" rel="stylesheet"/>
            
            
                <!--     Fonts and icons     -->
                <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
                <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
                <link href="bootstrap/css/pe-icon-7-stroke.css" rel="stylesheet">
                
            </head>
<body>
<div ng-app="myApp" ng-controller="myCtrl">
<div class="wrapper">
    <div class="sidebar" data-color="blue" data-image="assets/img/sidebar-4.jpg">

    <!--

        Tip 1: you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple"
        Tip 2: you can also add an image using data-image tag

    -->

    	<div class="sidebar-wrapper">
            <div class="logo">
                    <img src="img/itlp.png" class="brand_logo" alt="Logo">
            </div>

            <ul class="nav">
                <li class="active">
                    <a href="procesos.html">
                        <i class="pe-7s-graph"></i>
                        <p>Procesos</p>
                    </a>
                </li>
                <li>
                    <a href="procedimientos.html">
                        <i class="pe-7s-user"></i>
                        <p>Procedimientos</p>
                    </a>
                </li>
                <li>
                    <a href="anexos.html">
                        <i class="pe-7s-note2"></i>
                        <p>Anexos</p>
                    </a>
                </li>
                <li>
                    <a href="usuarios.html">
                        <i class="pe-7s-news-paper"></i>
                        <p>Usuarios</p>
                    </a>
                </li>
            </ul>
    	</div>
    </div>

    <div class="main-panel">
            <nav class="navbar navbar-default navbar-fixed">
                    <div class="container-fluid" id="mainheader">
                        <div class="navbar-header">
                                <a href="procesos.html" class="navbar-brand" id="navbar-brandf"> PROCESOS </a>
                                <a href="procedimientos.html" class="navbar-brand" id="navbar-brand"> PROCEDIMIENTOS </a>
                                <a href="anexos.html" class="navbar-brand" id="navbar-brand"> ANEXOS </a>
                                <a href="usuarios.html" class="navbar-brand" id="navbar-brand"> USUARIOS </a>
                                <a href="sig.html" class="navbar-brand" id="navbar-brand"> PAGINA PRINCIPAL </a>
                        </div>
                        <div class="collapse navbar-collapse" >
                            <ul class="nav navbar-nav navbar-right">
                                <li id="collapse">               
                                </li>
                                <li id="collapse">
                                        <a href="php/logout.php" class="navbar-brand" id="navbar-brandf"> SALIR </a>
                                    </li>
                                
                            </ul>
                        </div>
                    </div>
                </nav>


        
        <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                                <div class="card" id="header2">
                                        <div class="header">
                                            <h4 class="title">Agregar Nuevo Proceso</h4>
                                        
                                        <button type="button" class="btn btn-outline-primary" name="Agregar">Agregar</button>
                                    </div>
                                </div>
                            <div class="card">
                                <div class="header">
                                    <h4 class="title">Procesos</h4>
                                    <p class="category">Lista de procesos existentes</p>
                                </div>
                                <div class="content table-responsive table-full-width">
                                    <table id="tblSearch" class="table table-hover table-striped" ng-init='datos="1";pepe="1";farah="1"' ng-table="tableParams">
                                        <thead>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Disponibilidad</th>
                                            <th>Acción</th>
                                        </thead>
                                        <tbody>
                                                <tr ng-repeat="proceso in datos">
                                                        <td>{{proceso.id}}</td>  
                                                        <td>{{proceso.nombre}}</td>
                                                        <td>{{proceso.disponibilidad}}</td>
                                                        <td>
                                                                <img ng-click="Actualizar($index)" width="20px" name="Editar" height="20px" align="center" src="img/detalles.jpg"/>
                                                                <img ng-click="Eliminar($index,$event)" width="20px" name="Eliminar" height="20px" align="center" src="img/eliminar.png"/>
                                                                <img ng-click="Reactivar($index,$event)" width="20px" name="Reactivar" height="20px" align="center" src="img/reactivar.png"/>
                                                        </td>
                                                   </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
    
                    </div>
                </div>
        </div>

        <footer class="footer">
                <div class="container-fluid">
                        <nav class="pull-left">
                            <a>SISTEMA INTEGRADO DE GESTIÓN DEL INSTITUTO TECNOLÓGICO DE LA PAZ</a>
                        </nav>
                </div>
        </footer>

    </div>
</div>

<Divs>
<!--
    Div de agregar
-->
    <div id="divAgregar"  style="display:none" > 
        <div class="card" id="card">
                <div class="header" id="header">
                    <h4 id="title">Agregar Nuevo Proceso</h4>
                </div>
                <div class="content">
                    <form id="Proced" name="Proced">
                        <div class="row">
                                <div class="col-md-12">
                                        <div class="form-group">
                                        <label id="lb">Nombre del Proceso</label>
                                        <input type="text" class="form-control" placeholder="Nombre" name="idproceso">
                                            
                                        </div>
                                </div>
                        </div>
                        
                                
                       <br>
                        <div class="clearfix"></div>
                    </form>
                    <div class="col-md-12">
                        <div class="btn-group" role="group" aria-label="Basic example" id="btn-group">
                            <button name="btnCancelar" type="button" class="btn pull-right">Cancelar</button>
                            <button type="button" class="btn pull-right" data-ng-click="agregar()">Agregar</button>
                        </div>
                   </div>
                   <br>
                   <br>
                </div>
        </div>
    </div>
<!--
    Div de seguro eliminar
-->
   <div id="divSeguro"  style="display:none"> 
        <div class="card" id="card">
                <div class="header" id="header">
                    <h4 id="title">Eliminar Proceso</h4>
                </div>
                <div class="content">
                    <form id="seguro" name="seguro">
                        <div class="row">
                                <div class="col-md-12">
                                        <div class="form-group">
                                                <input type="hidden" name="ido" >
                                                <fieldset><legend>¿Seguro que desea eliminar el proceso {{farah}} ?</legend> 
                                                </fieldset>
                                        </div>                                 
                                </div>
                        </div>
                                 

                        <div class="clearfix"></div>
                    </form>
                       <div class="col-md-12">
                            <div class="btn-group" role="group" aria-label="Basic example" id="btn-group">
                                <button id="btnNo" type="button" class="btn pull-right">No</button>
                                <button id="btnSi" type="button" class="btn pull-right" data-ng-click="siElm()">Si</button>
                            </div>
                       </div>
                       <br>
                       <br>
                </div>
        </div>
   </div>  
   <!--
    Div de seguro reactivcar
-->
   <div id="divReact"  style="display:none"> 
    <div class="card" id="card">
            <div class="header" id="header">
                <h4 id="title">Activar Proceso</h4>
            </div>
            <div class="content">
                <form id="seguroA" name="seguroA">
                    <div class="row">
                            <div class="col-md-12">
                                    <div class="form-group">
                                            <input type="hidden" name="ida" >
                                            <fieldset><legend>¿Seguro que desea activar el proceso {{farah}} ?</legend> 
                                            </fieldset>
                                    </div>                                 
                            </div>
                    </div>
                             

                    <div class="clearfix"></div>
                </form>
                   <div class="col-md-12">
                        <div class="btn-group" role="group" aria-label="Basic example" id="btn-group">
                            <button id="btnNoA" type="button" class="btn pull-right">No</button>
                            <button id="btnSiA" type="button" class="btn pull-right" data-ng-click="siAct()">Si</button>
                        </div>
                   </div>
                   <br>
                   <br>
            </div>
    </div>
   </div>
   <!--
    Div de Cambiar Nombre
-->
    <div id="divCambiar"  style="display:none" > 
    <div class="card" id="card">
            <div class="header" id="header">
                <h4 id="title">Agregar Nuevo Proceso</h4>
            </div>
            <div class="content">
                <form id="Proced2" name="Proced2">
                    <div class="row">
                            <div class="col-md-12">
                                    <div class="form-group">
                                    <input type="hidden" name="idm" >
                                    <label id="lb">Nombre del Proceso</label>
                                    <input type="text" class="form-control" placeholder="Nombre" name="idproceso2">
                                        
                                    </div>
                            </div>
                    </div>
                    
                            
                   <br>
                    <div class="clearfix"></div>
                </form>
                <div class="col-md-12">
                    <div class="btn-group" role="group" aria-label="Basic example" id="btn-group">
                        <button name="btnCancelarC" type="button" class="btn pull-right">Cancelar</button>
                        <button type="button" class="btn pull-right" data-ng-click="cambiar()">Cambiar</button>
                    </div>
               </div>
               <br>
               <br>
            </div>
    </div>
    </div>
</Divs>
</div>
</body>

    <!--   Core JS Files   -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        var datos;
            $(document).ready(function(){
              $("[Name=Agregar]").click(function(){     
               $("#divAgregar").css("display","block");
               $("#Proced")[0].reset();
              });

              $("[Name=btnCancelar").click(function(){
                $("#divAgregar").css("display","none");   
              });

              $("[Name=btnCancelarC").click(function(){
                $("#divCambiar").css("display","none");   
              });

              $("#btnNo").click(function(){
               $("#divSeguro").css("display","none");   
              });

              $("#btnNoA").click(function(){
               $("#divReact").css("display","none");   
              });
            });
   
            
        </script>
    <script>
            var app = angular.module('myApp', [])	
            app.controller('myCtrl', function($scope, $http) {
                $http.get("php/Procesos.php")
                .then(function(response) {
                $scope.datos = response.data;
                datos = response.data;
                Elm();
                });
                function Elm()
                {
                    angular.element(document).ready(function () {
                    var cont=0;
                    var cont2=0;
                    var elem = angular.element(document.getElementsByTagName('td'));
                    for(i=0; i<elem.length; i++){
                        if(elem[cont].innerText=='No'){
                            cont2=cont2+1;
                            var elem2=elem[cont+1].children
                            elem2[1].style.opacity= "0.5";
                            elem2[2].style.opacity= "1";                           
                        }
                        if(elem[cont].innerText=='Si'){
                            cont2=cont2+1;
                            var elem2=elem[cont+1].children
                            elem2[1].style.opacity= "1";
                            elem2[2].style.opacity= "0.5";                           
                        }
                        cont=cont+1;
                    }
                });
                }

                $scope.agregar = function(){
                    $formulario = $("#Proced");
                    var datosFormulario = $formulario.serialize();
                    var request = $http({
                                method: "post",
                                url: "php/Procesos.php?op=i&"+datosFormulario,                    
                                data: datosFormulario
                            }).then(function(response) { 
                                  $scope.datos = response.data;
                                  datos = response.data;
                                  $("#divAgregar").css("display","none");
                                  Elm();
                            });
                };
                $scope.cambiar = function(){
                    $formulario = $("#Proced2");
                    var datosFormulario = $formulario.serialize();
                    var request = $http({
                                method: "post",
                                url: "php/Procesos.php?pf=i&"+datosFormulario,                    
                                data: datosFormulario
                            }).then(function(response) { 
                                  $scope.datos = response.data;
                                  datos = response.data;
                                  $("#divCambiar").css("display","none");
                                  Elm();
                            });
                };

                $scope.Eliminar = function(index,e) {
                    if(e.target.style.opacity!="0.5")
                    {
                    $scope.pepe = String(datos[index].id);
                    $scope.farah = String(datos[index].nombre);
                    $("input[name='ido']").val(datos[index].id);
                    $("#divSeguro").css("display","block");  
                    }                
                };
                $scope.Actualizar = function(index) {
                    $scope.pepe = String(datos[index].id);
                    $scope.farah = String(datos[index].nombre);
                    $("input[name='idm']").val(datos[index].id);
                    $("input[name='idproceso2']").val(datos[index].nombre);
                    $("#divCambiar").css("display","block");              
                };
                $scope.Reactivar = function(index,e) {
                    if(e.target.style.opacity!="0.5")
                    {
                    $scope.pepe = String(datos[index].id);
                    $scope.farah = String(datos[index].nombre);
                    $("input[name='ida']").val(datos[index].id);
                    $("#divReact").css("display","block");  
                    }                
                };

                $scope.siElm = function(){
                   $formulario = $("#seguro");
                   var datosFormulario = $formulario.serialize();
                   var request = $http({
                    method: "post",
                    url: "php/Procesos.php?pa=i&"+datosFormulario,                    
                    data: datosFormulario
                    }).then(function(response) {
                     $scope.datos = response.data;
                     datos = response.data; 
                      $("#divSeguro").css("display","none");
                      Elm();  
                    });

                };
                $scope.siAct = function(){
                   $formulario = $("#seguroA");
                   var datosFormulario = $formulario.serialize();
                   var request = $http({
                    method: "post",
                    url: "php/Procesos.php?pp=i&"+datosFormulario,                    
                    data: datosFormulario
                    }).then(function(response) {
                     $scope.datos = response.data;
                     datos = response.data; 
                      $("#divReact").css("display","none");
                      Elm();  
                    });

                };
            });
            </script>
</html>
